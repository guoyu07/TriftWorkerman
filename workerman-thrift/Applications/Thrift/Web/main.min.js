var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?r(s):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,r){function s(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var LoadingUI=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.setProgress=function(e,t){},t}(eui.Group);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,SocketConnectManager.getInstance().connect("ws://114.55.55.197:8189")}__extends(t,e);var n=(__define,t),r=n.prototype;return r.createChildren=function(){e.prototype.createChildren.call(this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},r.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},r.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},r.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},r.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},r.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},r.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},r.startCreateScene=function(){var e=new ScreenManager;this.addChild(e),e.registScreen("LoginUI",new LoginUI),e.registScreen("RegistUI",new RegistUI),e.registScreen("IdleUI",new IdleUI),e.registScreen("GameUI",new GameUI),e.changeScreen("LoginUI",null)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ScreenManager=function(e){function t(){e.call(this),this.screenMap=new Map,this.percentWidth=1,this.percentHeight=1}__extends(t,e);var n=(__define,t),r=n.prototype;return r.registScreen=function(e,t){t.setScreenManager(this),this.screenMap.set(e,t)},r.changeScreen=function(e,t){this.currentScreen=this.screenMap.get(e),null!=this.currentScreen&&(this.currentScreen.setUserData(t),this.removeChildren(),this.addChild(this.currentScreen),this.autoSetScale())},r.updateDisplayList=function(t,n){e.prototype.updateDisplayList.call(this,t,n),this.autoSetScale()},r.autoSetScale=function(){this.currentScreen.scaleY=this.currentScreen.scaleX=this.stage.stageWidth/this.currentScreen.width,this.currentScreen.width=this.stage.stageWidth/this.currentScreen.scaleX,this.currentScreen.height=this.stage.stageHeight/this.currentScreen.scaleY},t}(eui.Group);egret.registerClass(ScreenManager,"ScreenManager");var SocketConnectManager=function(){function e(){var t=this;this._reconnectID=0,this._eventDispatcher=new egret.EventDispatcher;var n=this;this.transport=new Thrift.TWebSocketTransport(""),this.transport.setCallBack(function(){egret.log("已连接上服务器"),0!=n._reconnectID&&egret.clearInterval(n._reconnectID),n._reconnectID=0,n._eventDispatcher.dispatchEventWith(e.onConnect)},function(){egret.log("与服务器断开连接"),0==n._reconnectID&&(n._reconnectID=egret.setInterval(t.reconnect,n,1e3)),n._eventDispatcher.dispatchEventWith(e.onClose)},function(){egret.log("无法连接服务器"),0==n._reconnectID&&(n._reconnectID=egret.setInterval(t.reconnect,n,4e3)),n._eventDispatcher.dispatchEventWith(e.onError)});var r=new Thrift.Protocol(this.transport,"Access?ws");this.accessClient=new AccessClient(r);var s=new Thrift.Protocol(this.transport,"Game?ws");this.gameClient=new GameClient(s)}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},n.addEventListener=function(e,t,n,r,s){this._eventDispatcher.addEventListener(e,t,n,r,s)},n.removeEventListener=function(e,t,n,r){this._eventDispatcher.removeEventListener(e,t,n,r)},n.setListener=function(){this.transport.setListener()},n.connect=function(e){this._ws_uri=e,this.transport.url=e,this.transport.open()},n.reconnect=function(){egret.log("正在重新连接服务器"),this.connect(this._ws_uri)},e.onConnect="onConnect",e.onError="onError",e.onClose="onClose",e}();egret.registerClass(SocketConnectManager,"SocketConnectManager");var BaseScreen=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),r=n.prototype;return r.setScreenManager=function(e){this.screenManager=e},r.getScreenManager=function(){return this.screenManager},r.setUserData=function(e){this.userData=e},t}(eui.Component);egret.registerClass(BaseScreen,"BaseScreen",["IScreenManager"]);var GameUI=function(e){function t(){var t=this;e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_ui/GameSkin.exml",SocketConnectManager.getInstance().setListener(),SocketConnectManager.getInstance().gameClient.fight(function(e){t.fight_text.text+=e.fight+"\n",t.fight_text.scrollV=t.fight_text.maxScrollV-25})}__extends(t,e);var n=(__define,t),r=n.prototype;return r.uiCompHandler=function(){},r.setUserData=function(e){this.userInfo=e},t}(BaseScreen);egret.registerClass(GameUI,"GameUI");var IdleUI=function(e){function t(){var t=this;e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_ui/IdleSkin.exml",SocketConnectManager.getInstance().setListener(),SocketConnectManager.getInstance().gameClient.matching(function(e){e.code==GameMacro.CMD_OK&&(t.target_name_l.text=e.match_uid+"",t.match_btn.enabled=!1,t.screenManager.changeScreen("GameUI",null))})}__extends(t,e);var n=(__define,t),r=n.prototype;return r.uiCompHandler=function(){this.match_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbtnHandler,this)},r.mbtnHandler=function(e){var t=this;e.currentTarget==this.match_btn&&("开始匹配"==this.match_btn.label?(this.match_btn.label="停止匹配",SocketConnectManager.getInstance().gameClient.matching(null)):(this.target_name_l.text="未准备",this.match_btn.enabled=!1,SocketConnectManager.getInstance().gameClient.stopMatching(function(e){e.code==GameMacro.CMD_OK&&(t.match_btn.label="开始匹配",t.match_btn.enabled=!0)})))},r.setUserData=function(e){this.userInfo=e,this.mine_name_l.text=e.user_id+""},t}(BaseScreen);egret.registerClass(IdleUI,"IdleUI");var LoginUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_ui/LoginSkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.uiCompHandler=function(){this.login_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbtnHandler,this),this.regist_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbtnHandler,this)},r.mbtnHandler=function(e){var t=this;e.currentTarget==this.login_btn?SocketConnectManager.getInstance().accessClient.login(this.user_name_ti.text,this.user_passwords_ti.text,function(e){t.result_l.text=e.msg,e.code==AccessMacro.CMD_OK&&(t.getScreenManager().changeScreen("GameUI",e.userInfo),SocketConnectManager.getInstance().gameClient.fight(null))}):e.target==this.regist_btn&&this.getScreenManager().changeScreen("RegistUI",null)},t}(BaseScreen);egret.registerClass(LoginUI,"LoginUI");var RegistUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_ui/RegistSkin.exml"}__extends(t,e);var n=(__define,t),r=n.prototype;return r.uiCompHandler=function(){this.regist_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbtnHandler,this),this.return_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.mbtnHandler,this)},r.mbtnHandler=function(e){var t=this;e.currentTarget==t.regist_btn?""==t.user_name_ti.text||""==t.user_passwords_ti.text?t.result_l.text="请输入用户名密码":SocketConnectManager.getInstance().accessClient.regist(t.user_name_ti.text,t.user_passwords_ti.text,function(e){t.result_l.text=e.msg}):e.target==t.return_btn&&t.getScreenManager().changeScreen("LoginUI",null)},t}(BaseScreen);egret.registerClass(RegistUI,"RegistUI");